#!/usr/bin/env sh

echo "üìù Validando mensaje de commit..."

# Verificar si Docker est√° corriendo
if ! docker-compose ps | grep -q "Up"; then
    echo "‚ö†Ô∏è  Advertencia: Contenedores no est√°n corriendo, saltando validaci√≥n"
    exit 0
fi

# Validar con commitlint dentro del contenedor
docker-compose exec -T app npx --no -- commitlint --edit $1

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Mensaje de commit inv√°lido"
    echo ""
    echo "üìã Formato correcto:"
    echo "  tipo(scope): descripci√≥n"
    echo ""
    echo "‚úÖ Tipos v√°lidos:"
    echo "  feat     - Nueva funcionalidad"
    echo "  fix      - Correcci√≥n de bug"
    echo "  docs     - Cambios en documentaci√≥n"
    echo "  style    - Formato de c√≥digo (sin cambios funcionales)"
    echo "  refactor - Refactorizaci√≥n de c√≥digo"
    echo "  perf     - Mejoras de rendimiento"
    echo "  test     - Agregar o modificar tests"
    echo "  build    - Cambios en build/dependencias"
    echo "  ci       - Cambios en CI/CD"
    echo "  chore    - Tareas de mantenimiento"
    echo "  revert   - Revertir commits anteriores"
    echo ""
    echo "üìù Ejemplos:"
    echo "  feat(auth): agregar login con Google"
    echo "  fix(api): corregir validaci√≥n de usuarios"
    echo "  docs(readme): actualizar instrucciones"
    echo "  chore(deps): actualizar laravel/debugbar"
    echo ""
    exit 1
fi

echo "‚úÖ Mensaje de commit v√°lido"
exit 0